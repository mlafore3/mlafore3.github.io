<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>React, redux and API oh my! â€“ Marc Laforet</title>
    <meta name="description" content="">
    <meta name="keywords" content="inprogress">
    <link rel="canonical" href="http://localhost:4000/react-reduc-api-oh-my/">
        <!-- Twitter Cards -->
    <meta name="twitter:title" content="React, redux and API oh my!">
    <meta name="twitter:description" content="">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="http://localhost:4000/assets/img/marc_emoji.png">
    <!-- Open Graph -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="React, redux and API oh my!">
    <meta property="og:description" content="">
    <meta property="og:url" content="http://localhost:4000/react-reduc-api-oh-my/">
    <meta property="og:site_name" content="Marc Laforet">
    <meta property="og:image" content="http://localhost:4000/assets/img/marc_emoji.png">

    
    
    <!-- Handheld -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicons -->
    
<link rel="shortcut icon" href="http://localhost:4000/assets/img/favicon/favicon.ico">

    <!-- Feed -->
    <link rel="alternate" type="application/rss+xml" title="Marc Laforet" href="http://localhost:4000/feed.xml">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css">
    <!-- Sweet Scroll -->
    <script type="text/javascript" src="http://localhost:4000/assets/js/sweet-scroll.min.js"></script>
    <!-- Particle System -->
    <script type="text/javascript" src="http://localhost:4000/assets/js/particles.min.js"></script>
</head>

  <body>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      $(function() {
        i = 0;
        $('.menuAc').css({
          'color': 'rgba(52, 152, 219, 1)'
        });
        $('.menuAc').click(function(){
          $(this).next('.menuMobil').animate({width:'toggle'},350);
          if (i%2==0) {
            $('.footer').css({
              'filter'         : 'blur(5px)'
            });
            $('.yazilar').css({
              'filter'         : 'blur(5px)'
            });
            $('.ust').css({
              'filter'         : 'blur(5px)'
            });
            $('ul.menu').css({
              'animation-duration': '0.1s'
            });
            i++;
          }
          else {
            $('.footer').css({
              'filter'         : 'blur(0px)'
            });
            $('.yazilar').css({
              'filter'         : 'blur(0px)'
            });
            $('.ust').css({
              'filter'         : 'blur(0px)'
            });
            i++;
          }

        });
      });
/* sweetScroll load */
      document.addEventListener("DOMContentLoaded", function () {
        const sweetScroll = new SweetScroll({/* some options */});

        /* particlesJS.load(<a href="https://github.com/dom-id" class="user-mention">@dom-id</a>, <a href="https://github.com/path-json" class="user-mention">@path-json</a>, <a href="https://github.com/callback" class="user-mention">@callback</a> (optional)); */
        particlesJS('particles-js', {
          "particles": {
            "number": {
              "value": 100,
              "density": {
                "enable": true,
                "value_area": 800
              }
            },
            "color": {
              "value": "#ffffff"
            },
            "shape": {
              "type": "polygon",
              "stroke": {
                "width": 0,
                "color": "#000000"
              },
              "polygon": {
                "nb_sides": 5
              },
              "image": {
                "src": "img/github.svg",
                "width": 100,
                "height": 100,
              }
            },
            "opacity": {
              "value": 0.5,
              "random": false,
              "anim": {
                "enable": false,
                "speed": 1,
                "opacity_min": 0.1,
                "sync": false
              }
            },
            "size": {
              "value": 3,
              "random": true,
              "anim": {
                "enable": false,
                "speed": 19.18081918081918,
                "size_min": 0.1,
                "sync": false
              }
            },
            "line_linked": {
              "enable": true,
              "distance": 150,
              "color": "#ffffff",
              "opacity": 0.4,
              "width": 1
            },
            "move": {
              "enable": true,
              "speed": 4,
              "direction": "none",
              "random": true,
              "straight": false,
              "out_mode": "out",
              "bounce": false,
              "attract": {
                "enable": false,
                "rotateX": 600,
                "rotateY": 1200
              }
            },
            nb: 80
          },
          "interactivity": {
            "detect_on": "window",
            "events": {
              "onhover": {
                "enable": false,
                "mode": "grab"
              },
              "onclick": {
                "enable": true,
                "mode": "push"
              },
              "resize": true
            },
            "modes": {
              "grab": {
                "distance": 400,
                "line_linked": {
                  "opacity": 1
                }
              },
              "bubble": {
                "distance": 400,
                "size": 40,
                "duration": 2,
                "opacity": 8,
                "speed": 3
              },
              "repulse": {
                "distance": 200,
                "duration": 0.4
              },
              "push": {
                "particles_nb": 4
              },
              "remove": {
                "particles_nb": 2
              }
            }
          },
          "retina_detect": true
        });

      }, false);
    </script>
    <div id="particles-js" style="height: 700%; position: absolute; width: 100vw;"></div>
    <div class="menuAc">
      <i class="fa fa-bars" aria-hidden="true"></i>
    </div>
    <div class="menuMobil">
          <nav class="nav-home">
      <ul class="menu">
            
				    
				    
				    
				
				    
				    
				    	<li class="item"><a class="link" href="#about" data-scroll>About</a></li>
				    
				
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/blog/">Blog</a></li>
				    
				
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/projects/">Projects</a></li>
				    
				
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/snippets/">Code Snippets</a></li>
				    
				
        </ul>
    </nav>

    </div>
    <div class="ust">
      <div class="ortalaAna">
        <div class="baslikAna">
          Marc Laforet
        </div>

        <div class="pc">
              <nav class="nav">
        <ul class="menuAna">
            
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/">Home</a></li>
				    
			
				    
				    
			
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/blog/">Blog</a></li>
				    
			
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/projects/">Projects</a></li>
				    
			
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/snippets/">Code Snippets</a></li>
				    
			
        </ul>
    </nav>

        </div>
      </div>
    </div>
    <div class="ortalaAna">
      <div class="yazilar">
        <div class="yazi">
          <div class="ustr">
            <h2>React, redux and API oh my!</h2>
            <div class="yazibilgisi">
              14 Mar 2018 Marc Laforet
            </div>
          </div>
          <hr>
          <div class="content">
            
<figure class="highlight"><pre><code class="language-py" data-lang="py"><span class="n">React</span><span class="p">,</span> <span class="n">Redux</span> <span class="ow">and</span> <span class="n">API</span> <span class="n">OH</span> <span class="n">MY</span><span class="err">!</span>

<span class="c"># React, Redux, API</span>

<span class="k">class</span> <span class="nc">UserDetailsSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ReadOnlyField</span><span class="p">()</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileSerializer</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'url'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'profile'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TenantSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ReadOnlyField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Tenant</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'credits'</span><span class="p">,</span> <span class="s">'credit_override'</span><span class="p">,</span> <span class="s">'max_concurrent'</span><span class="p">,</span> <span class="s">'app_scientist'</span><span class="p">,</span> <span class="s">'job_limit'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ProfileSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="n">tenant</span> <span class="o">=</span> <span class="n">TenantSerializer</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Profile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'tenant'</span><span class="p">,</span> <span class="s">'position'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">profile__tenant</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">tenant</span><span class="p">)</span>

    <span class="nd">@list_route</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'get'</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">current_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserDetailsSerializer</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">'permissions'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_perms</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_perms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_backends</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="s">"get_all_permissions"</span><span class="p">):</span>
                <span class="n">perms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">get_all_permissions</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">perms</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">perms</span>

<span class="c">#action </span>
<span class="n">export</span> <span class="n">function</span> <span class="n">fetchCurrentUser</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">url</span> <span class="o">=</span> <span class="s">'api/users/current_user/'</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">request</span> <span class="o">=</span> <span class="n">axios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">FETCH_CURRENT_USER</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c">#reducer </span>
<span class="n">export</span> <span class="n">default</span> <span class="n">function</span> <span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="n">null</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">switch</span> <span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="nb">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">case</span> <span class="n">FETCH_CURRENT_USER</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
    <span class="n">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">state</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c">#container</span>
<span class="k">class</span> <span class="nc">App</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
  <span class="n">constructor</span><span class="p">(</span><span class="n">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
    <span class="n">this</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span> <span class="n">currUser</span><span class="p">:</span> <span class="n">null</span> <span class="p">};</span>
    <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">fetchCurrentUser</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">currUser</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="n">Loading</span> <span class="o">/&gt;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;...</span><span class="p">)};</span>

<span class="n">function</span> <span class="n">mapStateToProps</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="n">currUser</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">currUser</span> <span class="p">};</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">mapDispatchToProps</span><span class="p">(</span><span class="n">dispatch</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">bindActionCreators</span><span class="p">({</span> <span class="n">fetchCurrentUser</span> <span class="p">},</span> <span class="n">dispatch</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">connect</span><span class="p">(</span><span class="n">mapStateToProps</span><span class="p">,</span> <span class="n">mapDispatchToProps</span><span class="p">)(</span><span class="n">App</span><span class="p">);</span>

<span class="n">App</span><span class="o">.</span><span class="n">propTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">currUser</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">shape</span><span class="p">({</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
  <span class="p">}),</span>
  <span class="n">currentUser</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">func</span><span class="p">,</span>
<span class="p">};</span></code></pre></figure>


          </div>
        </div>
        <script src="http://localhost:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $.goup({
        trigger: 500,
        bottomOffset: 10,
        locationOffset: 20,
        containerRadius: 0,
        containerColor: '#fff',
        arrowColor: '#000',
        goupSpeed: 'normal'
    });
});
</script>


        

      </div>
    </div>
  </body>
</html>
