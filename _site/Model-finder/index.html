<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Model finder – Marc Laforet</title>
    <meta name="description" content="">
    <meta name="keywords" content="snippet">
    <link rel="canonical" href="http://localhost:4000/Model-finder/">
        <!-- Twitter Cards -->
    <meta name="twitter:title" content="Model finder">
    <meta name="twitter:description" content="">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="http://localhost:4000/assets/img/marc_emoji.png">
    <!-- Open Graph -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Model finder">
    <meta property="og:description" content="">
    <meta property="og:url" content="http://localhost:4000/Model-finder/">
    <meta property="og:site_name" content="Marc Laforet">
    <meta property="og:image" content="http://localhost:4000/assets/img/marc_emoji.png">

    
    
    <!-- Handheld -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicons -->
    
<link rel="shortcut icon" href="http://localhost:4000/assets/img/favicon/favicon.ico">

    <!-- Feed -->
    <link rel="alternate" type="application/rss+xml" title="Marc Laforet" href="http://localhost:4000/feed.xml">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css">
    <!-- Sweet Scroll -->
    <script type="text/javascript" src="http://localhost:4000/assets/js/sweet-scroll.min.js"></script>
    <!-- Particle System -->
    <script type="text/javascript" src="http://localhost:4000/assets/js/particles.min.js"></script>
</head>

  <body>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      $(function() {
        i = 0;
        $('.menuAc').css({
          'color': 'rgba(52, 152, 219, 1)'
        });
        $('.menuAc').click(function(){
          $(this).next('.menuMobil').animate({width:'toggle'},350);
          if (i%2==0) {
            $('.footer').css({
              'filter'         : 'blur(5px)'
            });
            $('.yazilar').css({
              'filter'         : 'blur(5px)'
            });
            $('.ust').css({
              'filter'         : 'blur(5px)'
            });
            $('ul.menu').css({
              'animation-duration': '0.1s'
            });
            i++;
          }
          else {
            $('.footer').css({
              'filter'         : 'blur(0px)'
            });
            $('.yazilar').css({
              'filter'         : 'blur(0px)'
            });
            $('.ust').css({
              'filter'         : 'blur(0px)'
            });
            i++;
          }

        });
      });
/* sweetScroll load */
      document.addEventListener("DOMContentLoaded", function () {
        const sweetScroll = new SweetScroll({/* some options */});

        /* particlesJS.load(<a href="https://github.com/dom-id" class="user-mention">@dom-id</a>, <a href="https://github.com/path-json" class="user-mention">@path-json</a>, <a href="https://github.com/callback" class="user-mention">@callback</a> (optional)); */
        particlesJS('particles-js', {
          "particles": {
            "number": {
              "value": 100,
              "density": {
                "enable": true,
                "value_area": 800
              }
            },
            "color": {
              "value": "#ffffff"
            },
            "shape": {
              "type": "polygon",
              "stroke": {
                "width": 0,
                "color": "#000000"
              },
              "polygon": {
                "nb_sides": 5
              },
              "image": {
                "src": "img/github.svg",
                "width": 100,
                "height": 100,
              }
            },
            "opacity": {
              "value": 0.5,
              "random": false,
              "anim": {
                "enable": false,
                "speed": 1,
                "opacity_min": 0.1,
                "sync": false
              }
            },
            "size": {
              "value": 3,
              "random": true,
              "anim": {
                "enable": false,
                "speed": 19.18081918081918,
                "size_min": 0.1,
                "sync": false
              }
            },
            "line_linked": {
              "enable": true,
              "distance": 150,
              "color": "#ffffff",
              "opacity": 0.4,
              "width": 1
            },
            "move": {
              "enable": true,
              "speed": 4,
              "direction": "none",
              "random": true,
              "straight": false,
              "out_mode": "out",
              "bounce": false,
              "attract": {
                "enable": false,
                "rotateX": 600,
                "rotateY": 1200
              }
            },
            nb: 80
          },
          "interactivity": {
            "detect_on": "window",
            "events": {
              "onhover": {
                "enable": false,
                "mode": "grab"
              },
              "onclick": {
                "enable": true,
                "mode": "push"
              },
              "resize": true
            },
            "modes": {
              "grab": {
                "distance": 400,
                "line_linked": {
                  "opacity": 1
                }
              },
              "bubble": {
                "distance": 400,
                "size": 40,
                "duration": 2,
                "opacity": 8,
                "speed": 3
              },
              "repulse": {
                "distance": 200,
                "duration": 0.4
              },
              "push": {
                "particles_nb": 4
              },
              "remove": {
                "particles_nb": 2
              }
            }
          },
          "retina_detect": true
        });

      }, false);
    </script>
    <div id="particles-js" style="height: 700%; position: absolute; width: 100vw;"></div>
    <div class="menuAc">
      <i class="fa fa-bars" aria-hidden="true"></i>
    </div>
    <div class="menuMobil">
          <nav class="nav-home">
      <ul class="menu">
            
				    
				    
				    
				
				    
				    
				    	<li class="item"><a class="link" href="#about" data-scroll>About</a></li>
				    
				
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/blog/">Blog</a></li>
				    
				
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/projects/">Projects</a></li>
				    
				
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/snippets/">Code Snippets</a></li>
				    
				
        </ul>
    </nav>

    </div>
    <div class="ust">
      <div class="ortalaAna">
        <div class="baslikAna">
          Marc Laforet
        </div>

        <div class="pc">
              <nav class="nav">
        <ul class="menuAna">
            
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/">Home</a></li>
				    
			
				    
				    
			
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/blog/">Blog</a></li>
				    
			
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/projects/">Projects</a></li>
				    
			
				    
				    
				    	<li class="item"><a class="link" href="http://localhost:4000/snippets/">Code Snippets</a></li>
				    
			
        </ul>
    </nav>

        </div>
      </div>
    </div>
    <div class="ortalaAna">
      <div class="yazilar">
        <div class="yazi">
          <div class="ustr">
            <h2>Model finder</h2>
            <div class="yazibilgisi">
              14 Mar 2018 Marc Laforet
            </div>
          </div>
          <hr>
          <div class="content">
            <p>As a developer, I’m always trying to automate anything I can. You may call me lazy but I prefer to think of it as being clever. This desire to automate as much as I can appeared when I was working on a machine learning project a while ago. I realized that out-of-the-box algorithms (linear models, SVM, random forest, a basic neural net etc.) worked pretty well for a lot of cases, even for situations where they didn’t it was good to use them as bench marks. I always munge my dataset into a tidy format, which, would be very hard to automate. After this step however, I saw an opportunity to automate the training of different models mentioned above. I ended up creating an object-oriented program called model-finder that takes in a dataset and evaluates the performance of several different machine learning models. This program has two main abstractions, a dataset object and a model finder object. This approach to machine learning is called automated machine learning. Utilizing this process really helps me to make the model generation process more reproducible and stable for use in production code. Below is a code snippet for the dataset abstraction portion of this program.</p>

<figure class="highlight"><pre><code class="language-py" data-lang="py"><span class="k">class</span> <span class="nc">DataSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_path</span><span class="p">,</span> <span class="n">drop_features_ls</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">groupby_col</span><span class="p">,</span> <span class="n">validation_size</span><span class="p">,</span> <span class="n">test_size</span><span class="p">,</span> <span class="n">k_folds</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_filename</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">drop_features_ls</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_directories</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_features_ls</span> <span class="o">=</span> <span class="n">drop_features_ls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupby_col</span> <span class="o">=</span> <span class="n">groupby_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">test_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_folds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k_folds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_features</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_targets</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_features</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_targets</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_make_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">drop_features_ls</span><span class="p">):</span>
        <span class="n">drop_features_ls</span> <span class="o">=</span> <span class="p">[</span><span class="n">drop_features_ls</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">drop_features_ls</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="k">else</span> <span class="n">drop_features_ls</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="s">'_'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drop_features_ls</span><span class="p">)</span> <span class="k">if</span> <span class="n">drop_features_ls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">drop_features_ls</span>
        <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'{}_drop_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">_check_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'results'</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">'results'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'results/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">'results/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_remove_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_features_ls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drop_features_ls</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span> <span class="nf">_k_folds_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folds_dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">folds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">test_fold</span> <span class="o">=</span> <span class="s">'fold_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="n">folds_dict</span><span class="p">[</span><span class="n">test_fold</span><span class="p">]</span>
            <span class="n">train_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">fold</span> <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">fold</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">test_fold</span><span class="p">)</span>
            <span class="n">train_frames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">train_frames</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">folds_dict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">train_list</span><span class="p">))</span>
            <span class="n">train_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">train_frames</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">test_set</span><span class="p">,</span> <span class="n">train_set</span>

    <span class="k">def</span> <span class="nf">create_val_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">groupby_col</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">valset_size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">dat</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">dat</span>
        <span class="n">groupby_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_groupby</span> <span class="k">if</span> <span class="n">groupby_col</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">groupby_col</span>
        <span class="n">valset_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span> <span class="k">if</span> <span class="n">valset_size</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">valset_size</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s">'{}_validation_set_{}_rows'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">valset_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">groupby_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">unique_ls</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">groupby_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">val_ls</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">unique_ls</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_ls</span><span class="p">)</span> <span class="o">*</span> <span class="n">valset_size</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="o">~</span><span class="n">dat</span><span class="p">[</span><span class="n">groupby_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val_ls</span><span class="p">)]</span>
            <span class="n">val_set</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="p">[</span><span class="n">groupby_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val_ls</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">val_set</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">valset_size</span><span class="p">)</span>


        <span class="n">features</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">val_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s">'training_data'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s">'validation_set_full'</span><span class="p">,</span> <span class="n">val_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s">'features_validation_set'</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_dataset</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s">'targets_validation_set'</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'validation set is {} long and data is now {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val_set</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">split_into_k_folds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">groupby_col</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">k_folds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">dat</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">dat</span>
        <span class="n">k_folds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_folds</span> <span class="k">if</span> <span class="n">k_folds</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">k_folds</span>
        <span class="n">groupby_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_train_groupby</span> <span class="k">if</span> <span class="n">groupby_col</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">groupby_col</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s">'{}_K-fold_{}_groupedby_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">k_folds</span><span class="p">,</span> <span class="n">groupby_col</span><span class="p">)</span>

        <span class="n">df_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">k_folds</span><span class="p">)</span>
        <span class="n">fold_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'fold_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_split</span><span class="p">)}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fold_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_folds_generator</span><span class="p">(</span><span class="n">fold_dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="n">k_folder</span> <span class="o">=</span> <span class="s">'{}/K_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">test</span><span class="p">,</span> <span class="n">train</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">fold_generator</span><span class="p">)</span>

                <span class="n">train_features</span><span class="p">,</span> <span class="n">train_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
                <span class="n">test_features</span><span class="p">,</span> <span class="n">test_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_features</span><span class="p">,</span> <span class="n">train_features</span><span class="p">)</span>
		        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">)</span>
		        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_features</span><span class="p">,</span> <span class="n">test_features</span><span class="p">)</span>
		        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">)</span>

        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'{} folds created'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k_folds</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">split_into_test_and_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">groupby_col</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">dat</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">dat</span>
        <span class="n">test_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="k">if</span> <span class="n">test_size</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">test_size</span>
        <span class="n">groupby_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_train_groupby</span> <span class="k">if</span> <span class="n">groupby_col</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">groupby_col</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s">'{}_test_train_split_{}_groupedby_{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">test_size</span><span class="p">,</span> <span class="n">groupby_col</span><span class="p">)</span>

        <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>

        <span class="n">train_features</span><span class="p">,</span> <span class="n">train_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>
        <span class="n">test_features</span><span class="p">,</span> <span class="n">test_targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_features</span><span class="p">,</span> <span class="n">train_features</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_features</span><span class="p">,</span> <span class="n">test_features</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'train ({} rows) test ({} rows) split was created'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">selfs</span>

    <span class="k">def</span> <span class="nf">vectorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">target_col</span><span class="p">):</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">MinMaxScaler</span><span class="p">()</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_features</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span><span class="n">target_col</span><span class="p">]]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target_col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">feature_cols</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">scaled_features</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">scaled_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scaled_features</span><span class="p">,</span> <span class="n">targets</span>

    <span class="k">def</span> <span class="nf">one_hot_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">dat</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">dat</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'results/{}/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">folder</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">'results/{}/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">'results/{}/{}/{}.gz'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s">'gzip'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="c"># sample usage would be</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">DataSet</span><span class="p">(</span><span class="s">'path/to/file.csv'</span><span class="p">,</span> <span class="p">[</span><span class="s">'features'</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="s">'drop'</span><span class="p">],</span> <span class="s">'prediction_col'</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'.'</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">dat</span><span class="o">.</span><span class="n">create_val_set</span><span class="p">()</span>

<span class="c"># Then we would plug it into the finder object that would utilize the splitting/vectorizing methods as necessary </span>
<span class="n">model_grid</span> <span class="o">=</span> <span class="n">Finder</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">'classification'</span><span class="p">)</span>
<span class="n">model_grid</span><span class="o">.</span><span class="n">find_model</span><span class="p">(</span><span class="n">test_metrics</span><span class="o">=</span><span class="p">[</span><span class="n">roc_auc_score</span><span class="p">])</span></code></pre></figure>


          </div>
        </div>
        <script src="http://localhost:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $.goup({
        trigger: 500,
        bottomOffset: 10,
        locationOffset: 20,
        containerRadius: 0,
        containerColor: '#fff',
        arrowColor: '#000',
        goupSpeed: 'normal'
    });
});
</script>


        

      </div>
    </div>
  </body>
</html>
